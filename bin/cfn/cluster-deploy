#! /usr/bin/env bash
set -e # stop execution of the script if it fails

#This script will pass the value of the main root
export THEIA_WORKSPACE_ROOT=$(pwd)


CFN_PATH="$THEIA_WORKSPACE_ROOT/aws/cfn/cluster/template.yaml"


cfn-lint $CFN_PATH
aws cloudformation deploy \
  --stack-name "CrdCluster" \
  --template-file $CFN_PATH \
  --s3-bucket "cfn-artifacts-$RANDOM_STRING" \
  --no-execute-changeset \
  --tags group=cruddur-cluster \
  --capabilities CAPABILITY_NAMED_IAM